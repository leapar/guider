<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="http://libs.useso.com/js/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>

<script>
    $(function() {
        getVideos("http://player.youku.com/embed/XMTYwNTI0MzYyNA==",function(e) {
            if(!e.isok) {
                alert(e.msg);
            } else {
                alert(e.url);
            }
            console.log(e);
        });
        /* getVideos("XMjA2MzY1ODMy",function(e) {
            console.log(e);
        });*/

    });

function urlParameter(e){var r=[];for(var a in e)r.push(a+"="+e[a]);return r.join("&")}function getVideoId(e){var r=/(?:id_)(.*)(?:.html)/,a=/(?:v_playlist\/f)(.*)(?:o1p\d.html)/,t=/(?:youku.com\/embed\/)(.*)/,o=!1;if(r.test(e))o=r.exec(e);else if(a.test(e))o=a.exec(e);else{if(!t.test(e))return!1;o=t.exec(e)}return 2===o.length?o[1]:void 0}function match(e){return/v\.youku\.com/.test(e.attr("host"))&&!!window.videoId}function getFlvPath(e,r,a){$.ajax({url:e,headers:{Referer:"v.youku.com/v_show/id_"+r+".html"},dataType:"JSONP",success:function(e){return-1==e?void a({isok:!1}):void a({isok:!0,url:e[0].server})},error:function(e){a({isok:!1,msg:e.status})}})}function parseYoukuCode(e,r){var a=getVideoId(e);return a?void $.ajax({url:"http://play.youku.com/play/get.json?vid="+a+"&ct=12",headers:{Referer:"v.youku.com/v_show/id_"+a+".html"},dataType:"JSONP",success:function(e){if(console.log(e),-1==e)return void r({isok:!1,msg:"404"});var t=e.data,o=rc4(translate(mk.a3+"o0b"+userCache.a1,dic).toString(),decode64(t.security.encrypt_string)).split("_");userCache.sid=o[0],userCache.token=o[1];var i=new PlayListData(t,t.stream,"mp4");console.log(i._videoSegsDic.streams),getFlvPath(i._videoSegsDic.streams.guoyu.mp4[0].src,a,r)},error:function(e){r({isok:!1,msg:e.status})}}):void r({isok:!1,msg:"-1"})}function getVideos(e,r){parseYoukuCode(e,r)}function decode64(e){if(!e)return"";e=e.toString();var r,a,t,o,i,s,n,c=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);for(s=e.length,i=0,n="";s>i;){do r=c[255&e.charCodeAt(i++)];while(s>i&&-1==r);if(-1==r)break;do a=c[255&e.charCodeAt(i++)];while(s>i&&-1==a);if(-1==a)break;n+=String.fromCharCode(r<<2|(48&a)>>4);do{if(t=255&e.charCodeAt(i++),61==t)return n;t=c[t]}while(s>i&&-1==t);if(-1==t)break;n+=String.fromCharCode((15&a)<<4|(60&t)>>2);do{if(o=255&e.charCodeAt(i++),61==o)return n;o=c[o]}while(s>i&&-1==o);if(-1==o)break;n+=String.fromCharCode((3&t)<<6|o)}return n}function encode64(e){if(!e)return"";e=e.toString();var r,a,t,o,i,s,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=e.length,a=0,r="";t>a;){if(o=255&e.charCodeAt(a++),a==t){r+=n.charAt(o>>2),r+=n.charAt((3&o)<<4),r+="==";break}if(i=e.charCodeAt(a++),a==t){r+=n.charAt(o>>2),r+=n.charAt((3&o)<<4|(240&i)>>4),r+=n.charAt((15&i)<<2),r+="=";break}s=e.charCodeAt(a++),r+=n.charAt(o>>2),r+=n.charAt((3&o)<<4|(240&i)>>4),r+=n.charAt((15&i)<<2|(192&s)>>6),r+=n.charAt(63&s)}return r}function rc4(e,r){for(var a,t=[],o=0,i="",s=0;256>s;s++)t[s]=s;for(s=0;256>s;s++)o=(o+t[s]+e.charCodeAt(s%e.length))%256,a=t[s],t[s]=t[o],t[o]=a;s=0,o=0;for(var n=0;n<r.length;n++)s=(s+1)%256,o=(o+t[s])%256,a=t[s],t[s]=t[o],t[o]=a,i+=String.fromCharCode(r.charCodeAt(n)^t[(t[s]+t[o])%256]);return i}function translate(e,r){for(var a=[],t=0;t<e.length;t++){var o=0;o=e[t]>="a"&&e[t]<="z"?e[t].charCodeAt(0)-"a".charCodeAt(0):e[t]-"0"+26;for(var i=0;36>i;i++)if(r[i]==o){o=i;break}o>25?a[t]=o-26:a[t]=String.fromCharCode(o+97)}return a.join("")}function PlayListData(e,r,a){var t=this;new Date,this._sid=userCache.sid,this._fileType=a,this._videoSegsDic={},this._ip=e.security.ip;var o=(new RandomProxy,[]),i=[];i.streams={},i.logos={},i.typeArr={},i.totalTime={};for(var s=0;s<r.length;s++){for(var n=r[s].audio_lang,c=!1,u=0;u<o.length;u++)if(o[u]==n){c=!0;break}c||o.push(n)}for(var s=0;s<o.length;s++){for(var d=o[s],h={},l={},v=[],u=0;u<r.length;u++){var f=r[u];if(d==f.audio_lang){if(!t.isValidType(f.stream_type))continue;var g=t.convertType(f.stream_type),k=0;"none"!=f.logo&&(k=1),l[g]=k;var p=!1;for(var m in v)g==v[m]&&(p=!0);p||v.push(g);var y=f.segs;if(null==y)continue;var C=[];p&&(C=h[g]);for(var _=0;_<y.length;_++){var b=y[_];if(null==b)break;var S={};S.no=_,S.size=b.size,S.seconds=Number(b.total_milliseconds_video)/1e3,S.milliseconds_video=Number(f.milliseconds_video)/1e3,S.key=b.key,S.fileId=this.getFileId(f.stream_fileid,_),S.src=this.getVideoSrc(u,_,e,f.stream_type,S.fileId),S.type=g,C.push(S)}h[g]=C}}var A=this.langCodeToCN(d).key;i.logos[A]=l,i.streams[A]=h,i.typeArr[A]=v}this._videoSegsDic=i,this._videoSegsDic.lang=this.langCodeToCN(o[0]).key}function RandomProxy(e){this._randomSeed=e,this.cg_hun()}var dic=[19,1,4,7,30,14,28,8,24,17,6,35,34,16,9,10,13,22,32,29,31,21,18,3,2,23,25,27,11,20,5,15,12,0,33,26],mk={a3:"b4et",a4:"boa4"},userCache={a1:"4",a2:"1"};RandomProxy.prototype={cg_hun:function(){this._cgStr="";for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ/\\:._-1234567890",r=e.length,a=0;r>a;a++){var t=parseInt(this.ran()*e.length);this._cgStr+=e.charAt(t),e=e.split(e.charAt(t)).join("")}},cg_fun:function(e){for(var r=e.split("*"),a="",t=0;t<r.length-1;t++)a+=this._cgStr.charAt(r[t]);return a},ran:function(){return this._randomSeed=(211*this._randomSeed+30031)%65536,this._randomSeed/65536}},PlayListData.prototype={getFileId:function(e,r){if(null==e||""==e)return"";var a="",t=e.slice(0,8),o=r.toString(16);1==o.length&&(o="0"+o),o=o.toUpperCase();var i=e.slice(10,e.length);return a=t+o+i},isValidType:function(e){return"3gphd"==e||"flv"==e||"flvhd"==e||"mp4hd"==e||"mp4hd2"==e||"mp4hd3"==e?!0:!1},convertType:function(e){var r=e;switch(e){case"m3u8":r="mp4";break;case"3gphd":r="3gphd";break;case"flv":r="flv";break;case"flvhd":r="flv";break;case"mp4hd":r="mp4";break;case"mp4hd2":r="hd2";break;case"mp4hd3":r="hd3"}return r},langCodeToCN:function(e){var r="";switch(e){case"default":r={key:"guoyu",value:"国语"};break;case"guoyu":r={key:"guoyu",value:"国语"};break;case"yue":r={key:"yue",value:"粤语"};break;case"chuan":r={key:"chuan",value:"川话"};break;case"tai":r={key:"tai",value:"台湾"};break;case"min":r={key:"min",value:"闽南"};break;case"en":r={key:"en",value:"英语"};break;case"ja":r={key:"ja",value:"日语"};break;case"kr":r={key:"kr",value:"韩语"};break;case"in":r={key:"in",value:"印度"};break;case"ru":r={key:"ru",value:"俄语"};break;case"fr":r={key:"fr",value:"法语"};break;case"de":r={key:"de",value:"德语"};break;case"it":r={key:"it",value:"意语"};break;case"es":r={key:"es",value:"西语"};break;case"po":r={key:"po",value:"葡语"};break;case"th":r={key:"th",value:"泰语"}}return r},getVideoSrc:function(e,r,a,t,o,i,s){var n=a.stream[e],c=a.video.encodeid;if(!c||!t)return"";var u={flv:0,flvhd:0,mp4:1,hd2:2,"3gphd":1,"3gp":0},d=u[t],h={flv:"flv",mp4:"mp4",hd2:"flv",mp4hd:"mp4",mp4hd2:"mp4","3gphd":"mp4","3gp":"flv",flvhd:"flv"},l=h[t],v=r.toString(16);1==v.length&&(v="0"+v);var f=n.segs[r].total_milliseconds_video/1e3,g=n.segs[r].key;(""==g||-1==g)&&(g=n.key2+n.key1);var k="";a.show&&(k=a.show.pay?"&ypremium=1":"&ymovie=1");var p="/player/getFlvPath/sid/"+userCache.sid+"_"+v+"/st/"+l+"/fileid/"+o+"?K="+g+"&hd="+d+"&myp=0&ts="+f+"&ypp=0"+k,m=encodeURIComponent(encode64(rc4(translate(mk.a4+"poz"+userCache.a2,dic).toString(),userCache.sid+"_"+o+"_"+userCache.token)));return p+="&ep="+m,p+="&ctype=12",p+="&ev=1",p+="&token="+userCache.token,p+="&oip="+this._ip,p+=(i?"/password/"+i:"")+(s?s:""),p="http://k.youku.com"+p}};

</script>

</body>
</html>